- **CI injection hardening (`.github/workflows/ci.yml`, ~line 169):** Remove direct `${{ ... }}` interpolation of GitHub context values inside `run:` scripts. Move the value into `env:` (or `GITHUB_ENV`) and reference it as a quoted env var in the shell (`"$VAR"`). Add a unit-style workflow lint check (or a small script) that fails PRs if `run:` contains `${{ github.* }}` / `${{ steps.*.outputs.* }}` without going through `env:`.

- **UI XSS + rendering stability (`extension/ui/dashboard.ts`, multiple lines):** Eliminate `innerHTML`/`outerHTML`/`document.write` for any user/ADO-controlled data (titles, descriptions, build messages, artifact names, etc.). Prefer `textContent` + DOM construction; if HTML is truly required, sanitize with a vetted sanitizer and document the allowed tag/attr allowlist. Add tests that render hostile strings (`<img onerror=...>`, `</div>`, long text, unicode) and assert DOM structure remains intact.

- **CLI path traversal fix (highest priority in `src/ado_git_repo_insights/cli.py`, lines called out):** Replace all `".."/string` checks with canonical path validation: `resolved = Path(input).expanduser().resolve()` then enforce `resolved.is_relative_to(allowed_base)` (or `os.path.commonpath`). Apply this consistently to `out_dir`, any artifact paths, any extraction/output path, and any zip extraction destination. Add cross-platform tests (Windows separators, absolute paths, symlinks if applicable).

- **ZIP extraction safety (`cli.py`, ~line 1133):** Before extracting: validate it’s a zip, validate each member path resolves under the destination (no absolute paths, no `..`, no drive letters), and enforce total uncompressed size + per-file size limits to prevent zip bombs. Fail closed with a clear error message and keep partial extraction from persisting (extract to temp dir, then atomic move).

- **Atomic normalization / irreversible operations (`cli.py`, ~line 893):** Rework “layout normalization” to be transactional: operate in a temp directory, write the normalized output fully, then atomically swap/move into place (and keep a backup until success). Ensure failures leave original artifacts untouched. Add a test that forces an exception mid-normalization and asserts no corruption.

- **Process execution injection + reliability (`extension/tasks/_shared/safe-process.ts`, ~line 87):** Treat `exe` and args as untrusted unless proven otherwise. Restrict execution to an allowlist of known binaries (or known task commands), require `shell: false`, avoid string-joined commands, and validate each arg (type + disallow newlines/nulls). Add tests for paths with spaces (Windows) and ensure command construction is deterministic.

- **UI sync TOCTOU + rollback correctness (`src/ado_git_repo_insights/utils/ui_sync.py`, ~lines 154/187):** Remove “check-then-act” existence patterns; rely on atomic operations with exception handling. When rollback fails, preserve the original exception via exception chaining and emit both contexts. Add a concurrency-ish test (simulate file already removed/created between steps) to verify deterministic outcomes.

- **Artifact structure breaking change (`extension-verification-test.yml`, ~line 78):** If artifact structure changes, version it (e.g., `dataset-manifest.v2.json` or artifact name suffix), update consumers to accept both during transition, and document the migration path in release notes/docs. Add a CI gate that asserts artifact layout matches the declared version.

- **HTTP + server hardening (`cli.py`, ~lines 1091/1362):** Split timeouts by operation (short for metadata calls, longer for downloads), add bounded retries with exponential backoff, and set CORS to a configured allowlist (default to localhost-only). Ensure “server mode” is explicitly opt-in and clearly documented as dev-only if that’s the intent.

- **Logging format-string safety (`dashboard.ts` and `artifact-client.ts` info findings):** Replace string concatenation used as a format string with constant format strings (or template literals passed as a single argument). This is low priority; do it opportunistically while touching nearby code.

- **Type-only import consistency (`safe-process.ts` info findings):** Standardize on `import type` for purely type imports to avoid accidental runtime imports and keep bundling predictable. Do in a dedicated cleanup commit (no behavior changes).

- **Preserve the PowerBI CSV contract while fixing any of the above:** Any refactor that touches extraction/normalization/output must keep CSV filenames, column names, and column ordering identical; add a “golden CSV diff” test gate that fails on any schema/order drift.
